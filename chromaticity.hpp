#ifndef CHROMATICITY_HPP_INCLUDED
#define CHROMATICITY_HPP_INCLUDED

#include <array>
#include <vec/vec.hpp>

namespace chromaticity
{
    struct coordinate
    {
        float angle;
        float wavelength;
        float x;
        float y;
    };

    ///http://cvrl.ioo.ucl.ac.uk/ 1931 2 degrees
    inline
    std::vector<float> raw_horseshoe
    {
        360, 0.175560, 0.005294, 0.819146,
        361, 0.175483, 0.005286, 0.819231,
        362, 0.175400, 0.005279, 0.819321,
        363, 0.175317, 0.005271, 0.819412,
        364, 0.175237, 0.005263, 0.819500,
        365, 0.175161, 0.005256, 0.819582,
        366, 0.175088, 0.005247, 0.819665,
        367, 0.175015, 0.005236, 0.819749,
        368, 0.174945, 0.005226, 0.819829,
        369, 0.174880, 0.005221, 0.819899,
        370, 0.174821, 0.005221, 0.819959,
        371, 0.174770, 0.005229, 0.820001,
        372, 0.174722, 0.005238, 0.820040,
        373, 0.174665, 0.005236, 0.820098,
        374, 0.174595, 0.005218, 0.820187,
        375, 0.174510, 0.005182, 0.820309,
        376, 0.174409, 0.005127, 0.820464,
        377, 0.174308, 0.005068, 0.820624,
        378, 0.174222, 0.005017, 0.820761,
        379, 0.174156, 0.004981, 0.820863,
        380, 0.174112, 0.004964, 0.820924,
        381, 0.174088, 0.004964, 0.820948,
        382, 0.174073, 0.004973, 0.820955,
        383, 0.174057, 0.004982, 0.820961,
        384, 0.174036, 0.004986, 0.820978,
        385, 0.174008, 0.004981, 0.821012,
        386, 0.173972, 0.004964, 0.821064,
        387, 0.173932, 0.004943, 0.821125,
        388, 0.173889, 0.004926, 0.821185,
        389, 0.173845, 0.004916, 0.821239,
        390, 0.173801, 0.004915, 0.821284,
        391, 0.173754, 0.004925, 0.821321,
        392, 0.173705, 0.004937, 0.821358,
        393, 0.173655, 0.004944, 0.821401,
        394, 0.173606, 0.004940, 0.821454,
        395, 0.173560, 0.004923, 0.821517,
        396, 0.173514, 0.004895, 0.821590,
        397, 0.173468, 0.004865, 0.821667,
        398, 0.173424, 0.004836, 0.821740,
        399, 0.173380, 0.004813, 0.821807,
        400, 0.173337, 0.004797, 0.821866,
        401, 0.173291, 0.004786, 0.821923,
        402, 0.173238, 0.004779, 0.821983,
        403, 0.173174, 0.004775, 0.822051,
        404, 0.173101, 0.004774, 0.822125,
        405, 0.173021, 0.004775, 0.822204,
        406, 0.172934, 0.004781, 0.822285,
        407, 0.172843, 0.004791, 0.822366,
        408, 0.172751, 0.004799, 0.822450,
        409, 0.172662, 0.004802, 0.822536,
        410, 0.172577, 0.004799, 0.822624,
        411, 0.172489, 0.004795, 0.822715,
        412, 0.172396, 0.004796, 0.822808,
        413, 0.172296, 0.004803, 0.822901,
        414, 0.172192, 0.004815, 0.822993,
        415, 0.172087, 0.004833, 0.823081,
        416, 0.171982, 0.004855, 0.823163,
        417, 0.171871, 0.004889, 0.823240,
        418, 0.171741, 0.004939, 0.823319,
        419, 0.171587, 0.005010, 0.823402,
        420, 0.171407, 0.005102, 0.823490,
        421, 0.171206, 0.005211, 0.823583,
        422, 0.170993, 0.005334, 0.823674,
        423, 0.170771, 0.005470, 0.823759,
        424, 0.170541, 0.005621, 0.823838,
        425, 0.170301, 0.005789, 0.823911,
        426, 0.170050, 0.005974, 0.823976,
        427, 0.169786, 0.006177, 0.824037,
        428, 0.169505, 0.006398, 0.824097,
        429, 0.169203, 0.006639, 0.824158,
        430, 0.168878, 0.006900, 0.824222,
        431, 0.168525, 0.007184, 0.824291,
        432, 0.168146, 0.007491, 0.824363,
        433, 0.167746, 0.007821, 0.824433,
        434, 0.167328, 0.008175, 0.824496,
        435, 0.166895, 0.008556, 0.824549,
        436, 0.166446, 0.008964, 0.824589,
        437, 0.165977, 0.009402, 0.824622,
        438, 0.165483, 0.009865, 0.824652,
        439, 0.164963, 0.010351, 0.824687,
        440, 0.164412, 0.010858, 0.824731,
        441, 0.163828, 0.011385, 0.824787,
        442, 0.163210, 0.011937, 0.824853,
        443, 0.162552, 0.012520, 0.824928,
        444, 0.161851, 0.013137, 0.825011,
        445, 0.161105, 0.013793, 0.825102,
        446, 0.160310, 0.014491, 0.825199,
        447, 0.159466, 0.015232, 0.825302,
        448, 0.158573, 0.016015, 0.825412,
        449, 0.157631, 0.016840, 0.825529,
        450, 0.156641, 0.017705, 0.825654,
        451, 0.155605, 0.018609, 0.825786,
        452, 0.154525, 0.019556, 0.825920,
        453, 0.153397, 0.020554, 0.826049,
        454, 0.152219, 0.021612, 0.826169,
        455, 0.150985, 0.022740, 0.826274,
        456, 0.149691, 0.023950, 0.826359,
        457, 0.148337, 0.025247, 0.826416,
        458, 0.146928, 0.026635, 0.826437,
        459, 0.145468, 0.028118, 0.826413,
        460, 0.143960, 0.029703, 0.826337,
        461, 0.142405, 0.031394, 0.826201,
        462, 0.140796, 0.033213, 0.825991,
        463, 0.139121, 0.035201, 0.825679,
        464, 0.137364, 0.037403, 0.825233,
        465, 0.135503, 0.039879, 0.824618,
        466, 0.133509, 0.042692, 0.823798,
        467, 0.131371, 0.045876, 0.822753,
        468, 0.129086, 0.049450, 0.821464,
        469, 0.126662, 0.053426, 0.819912,
        470, 0.124118, 0.057803, 0.818079,
        471, 0.121469, 0.062588, 0.815944,
        472, 0.118701, 0.067830, 0.813468,
        473, 0.115807, 0.073581, 0.810612,
        474, 0.112776, 0.079896, 0.807328,
        475, 0.109594, 0.086843, 0.803563,
        476, 0.106261, 0.094486, 0.799253,
        477, 0.102776, 0.102864, 0.794360,
        478, 0.099128, 0.112007, 0.788865,
        479, 0.095304, 0.121945, 0.782751,
        480, 0.091294, 0.132702, 0.776004,
        481, 0.087082, 0.144317, 0.768601,
        482, 0.082680, 0.156866, 0.760455,
        483, 0.078116, 0.170420, 0.751464,
        484, 0.073437, 0.185032, 0.741531,
        485, 0.068706, 0.200723, 0.730571,
        486, 0.063993, 0.217468, 0.718539,
        487, 0.059316, 0.235254, 0.705430,
        488, 0.054667, 0.254096, 0.691238,
        489, 0.050031, 0.274002, 0.675967,
        490, 0.045391, 0.294976, 0.659633,
        491, 0.040757, 0.316981, 0.642262,
        492, 0.036195, 0.339900, 0.623905,
        493, 0.031756, 0.363598, 0.604646,
        494, 0.027494, 0.387921, 0.584584,
        495, 0.023460, 0.412703, 0.563837,
        496, 0.019705, 0.437756, 0.542539,
        497, 0.016268, 0.462955, 0.520777,
        498, 0.013183, 0.488207, 0.498610,
        499, 0.010476, 0.513404, 0.476120,
        500, 0.008168, 0.538423, 0.453409,
        501, 0.006285, 0.563068, 0.430647,
        502, 0.004875, 0.587116, 0.408008,
        503, 0.003982, 0.610447, 0.385570,
        504, 0.003636, 0.633011, 0.363352,
        505, 0.003859, 0.654823, 0.341318,
        506, 0.004646, 0.675898, 0.319456,
        507, 0.006011, 0.696120, 0.297869,
        508, 0.007988, 0.715342, 0.276670,
        509, 0.010603, 0.733413, 0.255984,
        510, 0.013870, 0.750186, 0.235943,
        511, 0.017766, 0.765612, 0.216622,
        512, 0.022244, 0.779630, 0.198126,
        513, 0.027273, 0.792104, 0.180623,
        514, 0.032820, 0.802926, 0.164254,
        515, 0.038852, 0.812016, 0.149132,
        516, 0.045328, 0.819391, 0.135281,
        517, 0.052177, 0.825164, 0.122660,
        518, 0.059326, 0.829426, 0.111249,
        519, 0.066716, 0.832274, 0.101010,
        520, 0.074302, 0.833803, 0.091894,
        521, 0.082053, 0.834090, 0.083856,
        522, 0.089942, 0.833289, 0.076769,
        523, 0.097940, 0.831593, 0.070468,
        524, 0.106021, 0.829178, 0.064801,
        525, 0.114161, 0.826207, 0.059632,
        526, 0.122347, 0.822770, 0.054882,
        527, 0.130546, 0.818928, 0.050526,
        528, 0.138702, 0.814774, 0.046523,
        529, 0.146773, 0.810395, 0.042832,
        530, 0.154722, 0.805864, 0.039414,
        531, 0.162535, 0.801238, 0.036226,
        532, 0.170237, 0.796519, 0.033244,
        533, 0.177850, 0.791687, 0.030464,
        534, 0.185391, 0.786728, 0.027881,
        535, 0.192876, 0.781629, 0.025495,
        536, 0.200309, 0.776399, 0.023292,
        537, 0.207690, 0.771055, 0.021255,
        538, 0.215030, 0.765595, 0.019375,
        539, 0.222337, 0.760020, 0.017643,
        540, 0.229620, 0.754329, 0.016051,
        541, 0.236885, 0.748524, 0.014591,
        542, 0.244133, 0.742614, 0.013253,
        543, 0.251363, 0.736606, 0.012031,
        544, 0.258578, 0.730507, 0.010916,
        545, 0.265775, 0.724324, 0.009901,
        546, 0.272958, 0.718062, 0.008980,
        547, 0.280129, 0.711725, 0.008146,
        548, 0.287292, 0.705316, 0.007391,
        549, 0.294450, 0.698842, 0.006708,
        550, 0.301604, 0.692308, 0.006088,
        551, 0.308760, 0.685712, 0.005528,
        552, 0.315914, 0.679063, 0.005022,
        553, 0.323066, 0.672367, 0.004566,
        554, 0.330216, 0.665628, 0.004156,
        555, 0.337363, 0.658848, 0.003788,
        556, 0.344513, 0.652028, 0.003459,
        557, 0.351664, 0.645172, 0.003163,
        558, 0.358814, 0.638287, 0.002899,
        559, 0.365959, 0.631379, 0.002662,
        560, 0.373102, 0.624451, 0.002448,
        561, 0.380244, 0.617502, 0.002254,
        562, 0.387379, 0.610542, 0.002079,
        563, 0.394507, 0.603571, 0.001922,
        564, 0.401626, 0.596592, 0.001782,
        565, 0.408736, 0.589607, 0.001657,
        566, 0.415836, 0.582618, 0.001546,
        567, 0.422921, 0.575631, 0.001448,
        568, 0.429989, 0.568649, 0.001362,
        569, 0.437036, 0.561676, 0.001288,
        570, 0.444062, 0.554714, 0.001224,
        571, 0.451065, 0.547766, 0.001169,
        572, 0.458041, 0.540837, 0.001123,
        573, 0.464986, 0.533930, 0.001084,
        574, 0.471899, 0.527051, 0.001051,
        575, 0.478775, 0.520202, 0.001023,
        576, 0.485612, 0.513389, 0.001000,
        577, 0.492405, 0.506615, 0.000980,
        578, 0.499151, 0.499887, 0.000962,
        579, 0.505845, 0.493211, 0.000944,
        580, 0.512486, 0.486591, 0.000923,
        581, 0.519073, 0.480029, 0.000899,
        582, 0.525600, 0.473527, 0.000872,
        583, 0.532066, 0.467091, 0.000843,
        584, 0.538463, 0.460725, 0.000812,
        585, 0.544787, 0.454434, 0.000779,
        586, 0.551031, 0.448225, 0.000744,
        587, 0.557193, 0.442099, 0.000708,
        588, 0.563269, 0.436058, 0.000673,
        589, 0.569257, 0.430102, 0.000641,
        590, 0.575151, 0.424232, 0.000616,
        591, 0.580953, 0.418447, 0.000601,
        592, 0.586650, 0.412758, 0.000591,
        593, 0.592225, 0.407190, 0.000586,
        594, 0.597658, 0.401762, 0.000580,
        595, 0.602933, 0.396497, 0.000571,
        596, 0.608035, 0.391409, 0.000556,
        597, 0.612977, 0.386486, 0.000537,
        598, 0.617779, 0.381706, 0.000516,
        599, 0.622459, 0.377047, 0.000493,
        600, 0.627037, 0.372491, 0.000472,
        601, 0.631521, 0.368026, 0.000453,
        602, 0.635900, 0.363665, 0.000435,
        603, 0.640156, 0.359428, 0.000416,
        604, 0.644273, 0.355331, 0.000396,
        605, 0.648233, 0.351395, 0.000372,
        606, 0.652028, 0.347628, 0.000344,
        607, 0.655669, 0.344018, 0.000313,
        608, 0.659166, 0.340553, 0.000281,
        609, 0.662528, 0.337221, 0.000251,
        610, 0.665764, 0.334011, 0.000226,
        611, 0.668874, 0.330919, 0.000207,
        612, 0.671859, 0.327947, 0.000194,
        613, 0.674720, 0.325095, 0.000185,
        614, 0.677459, 0.322362, 0.000179,
        615, 0.680079, 0.319747, 0.000174,
        616, 0.682582, 0.317249, 0.000170,
        617, 0.684971, 0.314863, 0.000167,
        618, 0.687250, 0.312586, 0.000164,
        619, 0.689426, 0.310414, 0.000160,
        620, 0.691504, 0.308342, 0.000154,
        621, 0.693490, 0.306366, 0.000145,
        622, 0.695389, 0.304479, 0.000133,
        623, 0.697206, 0.302675, 0.000119,
        624, 0.698944, 0.300950, 0.000106,
        625, 0.700606, 0.299301, 0.000093,
        626, 0.702193, 0.297725, 0.000083,
        627, 0.703709, 0.296217, 0.000074,
        628, 0.705163, 0.294770, 0.000067,
        629, 0.706563, 0.293376, 0.000061,
        630, 0.707918, 0.292027, 0.000055,
        631, 0.709231, 0.290719, 0.000050,
        632, 0.710500, 0.289453, 0.000047,
        633, 0.711724, 0.288232, 0.000044,
        634, 0.712901, 0.287057, 0.000041,
        635, 0.714032, 0.285929, 0.000040,
        636, 0.715117, 0.284845, 0.000038,
        637, 0.716159, 0.283804, 0.000036,
        638, 0.717159, 0.282806, 0.000035,
        639, 0.718116, 0.281850, 0.000034,
        640, 0.719033, 0.280935, 0.000032,
        641, 0.719912, 0.280058, 0.000030,
        642, 0.720753, 0.279219, 0.000028,
        643, 0.721555, 0.278420, 0.000026,
        644, 0.722315, 0.277662, 0.000023,
        645, 0.723032, 0.276948, 0.000020,
        646, 0.723702, 0.276282, 0.000016,
        647, 0.724328, 0.275660, 0.000012,
        648, 0.724914, 0.275078, 0.000007,
        649, 0.725467, 0.274530, 0.000003,
        650, 0.725992, 0.274008, 0.000000,
        651, 0.726495, 0.273505, 0.000000,
        652, 0.726975, 0.273025, 0.000000,
        653, 0.727432, 0.272568, 0.000000,
        654, 0.727864, 0.272136, 0.000000,
        655, 0.728272, 0.271728, 0.000000,
        656, 0.728656, 0.271344, 0.000000,
        657, 0.729020, 0.270980, 0.000000,
        658, 0.729361, 0.270639, 0.000000,
        659, 0.729678, 0.270322, 0.000000,
        660, 0.729969, 0.270031, 0.000000,
        661, 0.730234, 0.269766, 0.000000,
        662, 0.730474, 0.269526, 0.000000,
        663, 0.730693, 0.269307, 0.000000,
        664, 0.730896, 0.269104, 0.000000,
        665, 0.731089, 0.268911, 0.000000,
        666, 0.731280, 0.268720, 0.000000,
        667, 0.731467, 0.268533, 0.000000,
        668, 0.731650, 0.268350, 0.000000,
        669, 0.731826, 0.268174, 0.000000,
        670, 0.731993, 0.268007, 0.000000,
        671, 0.732150, 0.267850, 0.000000,
        672, 0.732300, 0.267700, 0.000000,
        673, 0.732443, 0.267557, 0.000000,
        674, 0.732581, 0.267419, 0.000000,
        675, 0.732719, 0.267281, 0.000000,
        676, 0.732859, 0.267141, 0.000000,
        677, 0.733000, 0.267000, 0.000000,
        678, 0.733142, 0.266858, 0.000000,
        679, 0.733281, 0.266719, 0.000000,
        680, 0.733417, 0.266583, 0.000000,
        681, 0.733551, 0.266449, 0.000000,
        682, 0.733683, 0.266317, 0.000000,
        683, 0.733813, 0.266187, 0.000000,
        684, 0.733936, 0.266064, 0.000000,
        685, 0.734047, 0.265953, 0.000000,
        686, 0.734143, 0.265857, 0.000000,
        687, 0.734221, 0.265779, 0.000000,
        688, 0.734286, 0.265714, 0.000000,
        689, 0.734341, 0.265659, 0.000000,
        690, 0.734390, 0.265610, 0.000000,
        691, 0.734438, 0.265562, 0.000000,
        692, 0.734482, 0.265518, 0.000000,
        693, 0.734523, 0.265477, 0.000000,
        694, 0.734560, 0.265440, 0.000000,
        695, 0.734592, 0.265408, 0.000000,
        696, 0.734621, 0.265379, 0.000000,
        697, 0.734649, 0.265351, 0.000000,
        698, 0.734673, 0.265327, 0.000000,
        699, 0.734690, 0.265310, 0.000000,
        700, 0.734690, 0.265310, 0.000000,
        701, 0.734690, 0.265310, 0.000000,
        702, 0.734690, 0.265310, 0.000000,
        703, 0.734690, 0.265310, 0.000000,
        704, 0.734690, 0.265310, 0.000000,
        705, 0.734690, 0.265310, 0.000000,
        706, 0.734690, 0.265310, 0.000000,
        707, 0.734690, 0.265310, 0.000000,
        708, 0.734690, 0.265310, 0.000000,
        709, 0.734690, 0.265310, 0.000000,
        710, 0.734690, 0.265310, 0.000000,
        711, 0.734690, 0.265310, 0.000000,
        712, 0.734690, 0.265310, 0.000000,
        713, 0.734690, 0.265310, 0.000000,
        714, 0.734690, 0.265310, 0.000000,
        715, 0.734690, 0.265310, 0.000000,
        716, 0.734690, 0.265310, 0.000000,
        717, 0.734690, 0.265310, 0.000000,
        718, 0.734690, 0.265310, 0.000000,
        719, 0.734690, 0.265310, 0.000000,
        720, 0.734690, 0.265310, 0.000000,
        721, 0.734690, 0.265310, 0.000000,
        722, 0.734690, 0.265310, 0.000000,
        723, 0.734690, 0.265310, 0.000000,
        724, 0.734690, 0.265310, 0.000000,
        725, 0.734690, 0.265310, 0.000000,
        726, 0.734690, 0.265310, 0.000000,
        727, 0.734690, 0.265310, 0.000000,
        728, 0.734690, 0.265310, 0.000000,
        729, 0.734690, 0.265310, 0.000000,
        730, 0.734690, 0.265310, 0.000000,
        731, 0.734690, 0.265310, 0.000000,
        732, 0.734690, 0.265310, 0.000000,
        733, 0.734690, 0.265310, 0.000000,
        734, 0.734690, 0.265310, 0.000000,
        735, 0.734690, 0.265310, 0.000000,
        736, 0.734690, 0.265310, 0.000000,
        737, 0.734690, 0.265310, 0.000000,
        738, 0.734690, 0.265310, 0.000000,
        739, 0.734690, 0.265310, 0.000000,
        740, 0.734690, 0.265310, 0.000000,
        741, 0.734690, 0.265310, 0.000000,
        742, 0.734690, 0.265310, 0.000000,
        743, 0.734690, 0.265310, 0.000000,
        744, 0.734690, 0.265310, 0.000000,
        745, 0.734690, 0.265310, 0.000000,
        746, 0.734690, 0.265310, 0.000000,
        747, 0.734690, 0.265310, 0.000000,
        748, 0.734690, 0.265310, 0.000000,
        749, 0.734690, 0.265310, 0.000000,
        750, 0.734690, 0.265310, 0.000000,
        751, 0.734690, 0.265310, 0.000000,
        752, 0.734690, 0.265310, 0.000000,
        753, 0.734690, 0.265310, 0.000000,
        754, 0.734690, 0.265310, 0.000000,
        755, 0.734690, 0.265310, 0.000000,
        756, 0.734690, 0.265310, 0.000000,
        757, 0.734690, 0.265310, 0.000000,
        758, 0.734690, 0.265310, 0.000000,
        759, 0.734690, 0.265310, 0.000000,
        760, 0.734690, 0.265310, 0.000000,
        761, 0.734690, 0.265310, 0.000000,
        762, 0.734690, 0.265310, 0.000000,
        763, 0.734690, 0.265310, 0.000000,
        764, 0.734690, 0.265310, 0.000000,
        765, 0.734690, 0.265310, 0.000000,
        766, 0.734690, 0.265310, 0.000000,
        767, 0.734690, 0.265310, 0.000000,
        768, 0.734690, 0.265310, 0.000000,
        769, 0.734690, 0.265310, 0.000000,
        770, 0.734690, 0.265310, 0.000000,
        771, 0.734690, 0.265310, 0.000000,
        772, 0.734690, 0.265310, 0.000000,
        773, 0.734690, 0.265310, 0.000000,
        774, 0.734690, 0.265310, 0.000000,
        775, 0.734690, 0.265310, 0.000000,
        776, 0.734690, 0.265310, 0.000000,
        777, 0.734690, 0.265310, 0.000000,
        778, 0.734690, 0.265310, 0.000000,
        779, 0.734690, 0.265310, 0.000000,
        780, 0.734690, 0.265310, 0.000000,
        781, 0.734690, 0.265310, 0.000000,
        782, 0.734690, 0.265310, 0.000000,
        783, 0.734690, 0.265310, 0.000000,
        784, 0.734690, 0.265310, 0.000000,
        785, 0.734690, 0.265310, 0.000000,
        786, 0.734690, 0.265310, 0.000000,
        787, 0.734690, 0.265310, 0.000000,
        788, 0.734690, 0.265310, 0.000000,
        789, 0.734690, 0.265310, 0.000000,
        790, 0.734690, 0.265310, 0.000000,
        791, 0.734690, 0.265310, 0.000000,
        792, 0.734690, 0.265310, 0.000000,
        793, 0.734690, 0.265310, 0.000000,
        794, 0.734690, 0.265310, 0.000000,
        795, 0.734690, 0.265310, 0.000000,
        796, 0.734690, 0.265310, 0.000000,
        797, 0.734690, 0.265310, 0.000000,
        798, 0.734690, 0.265310, 0.000000,
        799, 0.734690, 0.265310, 0.000000,
        800, 0.734690, 0.265310, 0.000000,
        801, 0.734690, 0.265310, 0.000000,
        802, 0.734690, 0.265310, 0.000000,
        803, 0.734690, 0.265310, 0.000000,
        804, 0.734690, 0.265310, 0.000000,
        805, 0.734690, 0.265310, 0.000000,
        806, 0.734690, 0.265310, 0.000000,
        807, 0.734690, 0.265310, 0.000000,
        808, 0.734690, 0.265310, 0.000000,
        809, 0.734690, 0.265310, 0.000000,
        810, 0.734690, 0.265310, 0.000000,
        811, 0.734690, 0.265310, 0.000000,
        812, 0.734690, 0.265310, 0.000000,
        813, 0.734690, 0.265310, 0.000000,
        814, 0.734690, 0.265310, 0.000000,
        815, 0.734690, 0.265310, 0.000000,
        816, 0.734690, 0.265310, 0.000000,
        817, 0.734690, 0.265310, 0.000000,
        818, 0.734690, 0.265310, 0.000000,
        819, 0.734690, 0.265310, 0.000000,
        820, 0.734690, 0.265310, 0.000000,
        821, 0.734690, 0.265310, 0.000000,
        822, 0.734690, 0.265310, 0.000000,
        823, 0.734690, 0.265310, 0.000000,
        824, 0.734690, 0.265310, 0.000000,
        825, 0.734690, 0.265310, 0.000000,
        826, 0.734690, 0.265310, 0.000000,
        827, 0.734690, 0.265310, 0.000000,
        828, 0.734690, 0.265310, 0.000000,
        829, 0.734690, 0.265310, 0.000000,
        830, 0.734690, 0.265310, 0.000000,
    };

    inline
    std::vector<coordinate> as_coordinates()
    {
        std::vector<coordinate> ret;

        float cx = 0.3333f;
        float cy = 0.3333f;

        for(int i=0; i < raw_horseshoe.size(); i += 4)
        {
            float wavelength = raw_horseshoe[i * 4 + 0];
            float x = raw_horseshoe[i * 4 + 1];
            float y = raw_horseshoe[i * 4 + 2];
            ///z = 1 - x - y

            float rcx = x - cx;
            float rcy = y - cy;

            float angle = atan2(rcy, rcx);

            coordinate c;
            c.wavelength = wavelength;
            c.x = x;
            c.y = y;
            c.angle = angle;

            ret.push_back(c);
        }

        return ret;
    }

    inline
    float circular_diff(float f1, float f2)
    {
        vec2f v1 = {cos(f1), sin(f1)};
        vec2f v2 = {cos(f2), sin(f2)};

        return atan2(v1.x() * v2.y() - v1.y() * v2.x(), v1.x() * v2.x() + v1.y() * v2.y());
    }

    inline
    float srgb_to_wavelength(vec3f in)
    {
        std::vector<coordinate> all_coordinates = as_coordinates();

        vec3f lin_colour = srgb_to_lin(in);

        vec3f XYZ = linear_rgb_to_XYZ(lin_colour);

        float sum = XYZ.sum();

        if(sum <= 0.000001)
           sum = 0.000001;

        vec2f xy = {XYZ.x() / sum, XYZ.y() / sum};

        float angle = (xy - (vec2f{0.3333f, 0.3333f})).angle();

        printf("Angle %f\n", angle);

        vec2f c = vec2f{1, 0}.rot(angle);

        for(int i=0; i < (int)all_coordinates.size() - 1; i++)
        {
            float a1 = all_coordinates[i].angle;
            float a2 = all_coordinates[i + 1].angle;

            vec2f a = (vec2f{1, 0}).rot(a1);
            vec2f b = (vec2f{1, 0}).rot(a2);

            if(angle_between_vectors(c, a) < angle_between_vectors(a, b))
                return all_coordinates[i].wavelength;
        }

        return -1;
    }
}

#endif // CHROMATICITY_HPP_INCLUDED
